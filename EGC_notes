11/11/24 Trying Code 

-Need to run every time: Pull any changes from Github
cd /uufs/chpc.utah.edu/common/home/saarman-group1/cx_ddRAD_scripts/
git pull


* fatal: detected dubious ownership in repository at '/uufs/chpc.utah.edu/common/home/saarman-group1/cx_ddRAD_scripts'
To add an exception for this directory, call:
        git config --global --add safe.directory /uufs/chpc.utah.edu/common/home/saarman-group1/cx_ddRAD_scripts
[u1055819@frisco1 cx_ddRAD_scripts]$ 


*Can't pull from github so the slurm files I have in CHPC are older ... I could manually change them in interactive session?


12/6/24

Made file for barcodes and original IDs for each sample. Only 95 in the example, so had to add my last sample in manually (agctaaga+C	CB01-I repeated from first plate)

*Using terminal on my mac? Was going to try the CHPC but that wasnt working at first, will try again. 
Going through README file trying to git pull into Cx_ddRAD scripts directory 

git pull
fatal: detected dubious ownership in repository at '/uufs/chpc.utah.edu/common/home/saarman-group1/cx_ddRAD_scripts'
To add an exception for this directory, call:

	git config --global --add safe.directory /uufs/chpc.utah.edu/common/home/saarman-group1/cx_ddRAD_scripts


12/17/2024
cd /uufs/chpc.utah.edu/common/home/saarman-group1/cx_ddRAD_scripts/
git pull

sbatch: error: invalid partition specified: saarman-shared-np
sbatch: error: Batch job submission failed: Invalid partition name specified
[u1055819@frisco1 cx_ddRAD_scripts]$ scontrol show partition saarman-shared-np
Partition saarman-shared-np not found

[u1055819@frisco1 saarman-group1]$ myallocation
Deprecation note: this program will not support the upcoming Granite cluster and beyond. Use `mychpc batch` instead.
        You have a general allocation on kingspeak. Account: saarman, Partition: kingspeak
        You have a general allocation on kingspeak. Account: saarman, Partition: kingspeak-shared
        You have a general allocation on kingspeak. Account: usu-biol4750, Partition: kingspeak
        You have a general allocation on kingspeak. Account: usu-biol4750, Partition: kingspeak-shared
        You can use preemptable mode on kingspeak. Account: owner-guest, Partition: kingspeak-guest
        You can use preemptable mode on kingspeak. Account: owner-guest, Partition: kingspeak-shared-guest
        Your group saarman does not have a general allocation on notchpeak
        You can use preemptable mode on notchpeak. Account: saarman, Partition: notchpeak-freecycle
        You can use preemptable mode on notchpeak. Account: saarman, Partition: notchpeak-shared-freecycle
        Your group usu-biol4750 does not have a general allocation on notchpeak
        You can use preemptable mode on notchpeak. Account: usu-biol4750, Partition: notchpeak-freecycle
        You can use preemptable mode on notchpeak. Account: usu-biol4750, Partition: notchpeak-shared-freecycle
        You have a general allocation on notchpeak. Account: dtn, Partition: notchpeak-dtn
        You have a general allocation on notchpeak. Account: notchpeak-shared-short, Partition: notchpeak-shared-short
        You have an owner allocation on notchpeak. Account: saarman-np, Partition: saarman-np
        You have an owner allocation on notchpeak. Account: saarman-np, Partition: saarman-shared-np
        You can use preemptable mode on notchpeak. Account: owner-guest, Partition: notchpeak-guest
        You can use preemptable mode on notchpeak. Account: owner-guest, Partition: notchpeak-shared-guest
        You have a general allocation on lonepeak. Account: saarman, Partition: lonepeak
        You have a general allocation on lonepeak. Account: saarman, Partition: lonepeak-shared
        You have a general allocation on lonepeak. Account: usu-biol4750, Partition: lonepeak
        You have a general allocation on lonepeak. Account: usu-biol4750, Partition: lonepeak-shared
        You can use preemptable mode on lonepeak. Account: owner-guest, Partition: lonepeak-guest
        You can use preemptable mode on lonepeak. Account: owner-guest, Partition: lonepeak-shared-guest


12/18/2024
git pull
sbatch 1a_process_radtags.slurm
slurm-2662574.out

1/1/2025

git pull
sbatch 5c
slurm-2761369_1.out

1/7/25
sbatch 6b_bwa - ran but gave this error 

[M::bwa_idx_load_from_disk] read 0 ALT contigs
[M::process] read 122326 sequences (40000602 bp)...
[M::process] read 122326 sequences (40000602 bp)...
slurmstepd: error: *** JOB 2761373 ON notch320 CANCELLED AT 2025-01-07T12:09:22 ***

*Not sure why maybe the old job that I cancelled is effecting this one... going to try one more time to see if the same error happens
slurm-2807933.out

1/8/25
Meeting with Norah - deleted unneccessary files - did not have to run 5c.. running 6b again to make sure it worked correctly
git pull 
sbatch 6b_bwa
Submitted batch job 2811975

Success! results in flagstat_results.tsv

1/13/2025
I am unsure where to pull from to edit 6b_refmap or 7b_populations slurm scripts... i do not see anything about stacks in ours or alkali bee project

1/17/2025
Meeting with Norah - confirmed what to do with 6b_refmap -> created refmap dummy file, checked that stacks module was available
Tried to run 6b_refmap 
Submitted batch job 2863149

Error - Parsed population map: 96 files in 1 population and 1 group.
Found 96 sample file(s).

Calling variants, genotypes and haplotypes...
  /uufs/chpc.utah.edu/sys/installdir/r8/stacks/2.64/bin/gstacks -I /uufs/chpc.utah.edu/common/home/saarman-group1/cx_ddRAD_bwa/ -M /uufs/chpc.utah.edu/common/home/saarman-group1/cx_ddRAD_scripts/cx_dummyplate2.txt -O /uufs/chpc.utah.edu/common/home/saarman-group1/cx_ddRAD_stacks


ref_map.pl: Aborted because the last command failed (1); see ref_map.log file.
Last command executed by ref_map.pl was:
  /uufs/chpc.utah.edu/sys/installdir/r8/stacks/2.64/bin/gstacks -I /uufs/chpc.utah.edu/common/home/saarman-group1/cx_ddRAD_bwa/ -M /uufs/chpc.utah.edu/common/home/saarman-group1/cx_ddRAD_scripts/cx_dummyplate2.txt -O /uufs/chpc.utah.edu/common/home/saarman-group1/cx_ddRAD_stacks


***Got an error just in sample Cb020I - it had a small BAM file so likely had poor alignment to begin with - should this sample be discarded?
samtools view /uufs/chpc.utah.edu/common/home/saarman-group1/cx_ddRAD_bwa/Cb020I.bam | head

1/19/25

Trying to diagnose the issue. A few possibilities: 

Paired-End Information:
0 + 0 paired in sequencing: This file does not contain paired-end reads; it consists of single-end reads.
*Implication: Ensure your pipeline parameters (e.g., in gstacks) are compatible with single-end data

Going to try excluding sample Cb020I from the analysis it has super low reads in BAM file 
samtools flagstat Cb020I.bam 
20 + 0 in total (QC-passed reads + QC-failed reads)
9 + 0 primary
11 + 0 secondary
0 + 0 supplementary
0 + 0 duplicates
0 + 0 primary duplicates
14 + 0 mapped (70.00% : N/A)
3 + 0 primary mapped (33.33% : N/A)
0 + 0 paired in sequencing
0 + 0 read1
0 + 0 read2
0 + 0 properly paired (N/A : N/A)
0 + 0 with itself and mate mapped
0 + 0 singletons (N/A : N/A)
0 + 0 with mate mapped to a different chr
0 + 0 with mate mapped to a different chr (mapQ>=5)

mkdir /uufs/chpc.utah.edu/common/home/saarman-group1/cx_ddRAD_bwa/excluded
mv /uufs/chpc.utah.edu/common/home/saarman-group1/cx_ddRAD_bwa/{Cb020I.bam,Cb012E.bam,Cb018F.bam,Cb017H.bam,Cb015D.bam,Cb014G.bam,Cb016B.bam} /uufs/chpc.utah.edu/common/home/saarman-group1/cx_ddRAD_bwa/excluded/


Removed 7 files total - 
Cb020I.bam	
Cb018F.bam	
Cb017H.bam	
Cb012E.bam	
Cb015D.bam	
Cb014G.bam	
Cb016B.bam

made new output file cx_ddRAD_stacks_filtered
sbatch 6b_refmap.slurm 
Submitted batch job 2882783

sbatch 7b
Submitted batch job 2882814

1/22/25
Meeting with Norah - adding 8b bcftools step for Allele balance, can remove 8c_vcf
Changed 8a to make filters harder and softer options

sbatch 8a_plink.slurm 
Submitted batch job 2906973

*error wrong file name, had to add vcf module, 

1/23/25
Split 8plink into steps a and b to convert plink to vcf
Submitted batch job 2922703

After filtering, kept 89 out of 89 Individuals
Outputting VCF file...
After filtering, kept 13597 out of a possible 36024 Sites
Run Time = 2.00 seconds

Submitted batch job 2923700

[filter.c:2933 filters_init1] Error: the tag "AB" is not defined in the VCF header
Start time : 14:08:59

1/29/25
Troubleshooting AB balance as Allele Depth calculation



